---
import { getCollection } from 'astro:content';
import OssItemSimple from '../molecules/OssItemSimple.astro';
import OssItemOgp from '../molecules/OssItemOgp.astro';
import TalkCard from '../molecules/TalkCard.astro';

export interface Props {
  /** OSS の表示タイプ: 'simple' | 'ogp' */
  ossType?: 'simple' | 'ogp';
}

const { ossType = 'simple' } = Astro.props;

const allOss = await getCollection('oss');
const allTalks = await getCollection('talks');

// date 降順（最新が先）
const sortedTalks = allTalks.sort((a, b) => b.data.date.localeCompare(a.data.date));
---

<section
  class="rounded-3xl p-6 flex flex-col gap-6 w-full"
  style="background: var(--color-surface); box-shadow: 0 1px 4px var(--color-shadow-sm);"
>
  <h2 class="text-sm font-semibold uppercase tracking-wider" style="color: var(--color-primary);">
    Activity
  </h2>

  <!-- OSS Contributions -->
  <div class="flex flex-col gap-3">
    <h3 class="text-xs font-mono" style="color: var(--color-text-secondary);">OSS Contributions</h3>
    <div class="flex flex-col gap-3">
      {allOss.map((item) => (
        ossType === 'ogp'
          ? <OssItemOgp url={item.data.url} />
          : <OssItemSimple repo={item.data.repo} url={item.data.url} description={item.data.description} />
      ))}
    </div>
  </div>

  <!-- Talks -->
  <div class="flex flex-col gap-3">
    <h3 class="text-xs font-mono" style="color: var(--color-text-secondary);">Talks</h3>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      {sortedTalks.map((talk) => (
        <TalkCard
          title={talk.data.title}
          event={talk.data.event}
          date={talk.data.date}
          url={talk.data.url}
        />
      ))}
    </div>
  </div>
</section>
