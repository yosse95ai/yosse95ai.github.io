---
import TimelineItem from '../molecules/TimelineItem.astro';
import { getCollection } from 'astro:content';

export interface Props {
  /** true のとき全件表示、false のとき最新3件のみ */
  showAll?: boolean;
}

const { showAll = false } = Astro.props;

const allCareer = await getCollection('career');
// startDate 降順（最新が上）
const sorted = allCareer.sort(
  (a, b) => b.data.startDate.localeCompare(a.data.startDate)
);
const items = showAll ? sorted : sorted.slice(0, 3);
const hasMore = !showAll;
---

<section
  class="rounded-3xl p-6 flex flex-col gap-4 w-full"
  style="background: var(--color-surface); box-shadow: 0 1px 4px var(--color-shadow-sm);"
>
  <h2 class="text-sm font-semibold uppercase tracking-wider" style="color: var(--color-primary);">
    Career
  </h2>

  <div class="flex-1">
    {items.map((item, i) => (
      <TimelineItem
        organization={item.data.organization}
        role={item.data.role}
        startDate={item.data.startDate}
        endDate={item.data.endDate ?? null}
        isLast={i === items.length - 1}
      />
    ))}
  </div>

  {hasMore && (
    <a
      href="/history"
      class="inline-flex items-center gap-1 text-xs font-medium transition-all duration-200 hover:gap-2 no-underline self-start"
      style="color: var(--color-primary);"
    >
      全てを見る
      <span aria-hidden="true">→</span>
    </a>
  )}
</section>
